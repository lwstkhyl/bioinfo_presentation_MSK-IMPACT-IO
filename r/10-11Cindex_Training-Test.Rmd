---
title: "10-11Cindex_Training-Test"
output: html_document
date: "2024-10-22"
---

**读取数据**：
```{r}
library("survcomp")
data_training <- read.table("../pycharm/data/Training_RF_Prob.txt", header = T, sep = '\t');
data_test <- read.table("../pycharm/data/Test_RF_Prob.txt", header = T, sep = '\t');
```

```{r}
get_cindex <- function(data, cancer_type = -1, os_type = 'os'){
  if(cancer_type!=-1) data <- data[grep(as.character(cancer_type), data$Cancer_Type), ];
  if(os_type=='os') {
    surv_time <- data$OS_Months;
    surv_event <- data$OS_Event;
  } else {
    surv_time <- data$PFS_Months;
    surv_event <- data$PFS_Event;
  }
  c_rf16 <- concordance.index(
    x = -data$RF16_prob, 
    surv.time = surv_time, 
    surv.event = surv_event, 
    method = "noether"
  );
  c_rf11 <- concordance.index(
    x = -data$RF11_prob, 
    surv.time = surv_time, 
    surv.event = surv_event, 
    method = "noether"
  );
  c_tmb <- concordance.index(
    x = -data$TMB, 
    surv.time = surv_time, 
    surv.event = surv_event, 
    method = "noether"
  );
  print(paste0("RF16：cindex--", round(c_rf16[["c.index"]], 2), ", upper cindex--", round(c_rf16[["upper"]], 2)));
  print(paste0("RF11：cindex--", round(c_rf11[["c.index"]], 2), ", upper cindex--", round(c_rf11[["upper"]], 2)));
  print(paste0("TMB：cindex--", round(c_tmb[["c.index"]], 2), ", upper cindex--", round(c_tmb[["upper"]], 2)));
  rf16_rf11 <- cindex.comp(c_rf16, c_rf11);
  rf16_tmb <- cindex.comp(c_rf16, c_tmb);
  rf11_tmb <- cindex.comp(c_rf11, c_tmb);
  print(paste0("RF16-RF11 pvalue--", rf16_rf11[["p.value"]]));
  print(paste0("RF16-TMB pvalue--", rf16_tmb[["p.value"]]));
  print(paste0("RF11-TMB pvalue--", rf11_tmb[["p.value"]]));
  return(list(
    c(c_rf16[["c.index"]], c_rf11[["c.index"]], c_tmb[["c.index"]]),
    c(c_rf16[["upper"]], c_rf11[["upper"]], c_tmb[["upper"]]),
    c(rf16_rf11[["p.value"]], rf16_tmb[["p.value"]])
  ));
}
```


```{r}
res <- get_cindex(data_test, 0, 'os')
```

```{r}

```

